<div class="strapi-table-container full-width full-height" fixedLayout="true"fxLayout="column" fxLayoutAlign="stretch start">
  <mat-progress-bar class="full-width" mode="indeterminate" color="accent" *ngIf="dataSource.loading$ | async"></mat-progress-bar>
  <mat-table [ngClass]="{loading: (dataSource.loading$ | async)}" fxFlex="1 1 auto" mat-table class="strapi-table full-width" [dataSource]="dataSource" matSort matSortDirection="asc" matSortDisableClear>
    <ng-container [matColumnDef]="column.key" *ngFor="let column of columnsDefinition">
      <mat-header-cell *matHeaderCellDef [mat-sort-header]="column.sortable ? column.key : ''">{{ column.translationKey | transloco}}</mat-header-cell>
      <mat-cell *matCellDef="let entity">
        <ng-container [ngSwitch]="column.type">
          <span class="full-width text-overflow-ellipsis nowrap" *ngSwitchCase="columnTypesEnum.DATE">
            {{column.displayedProp ? (entity | parseObjectKey:column.displayedProp | date:'short') : entity[column.key]}}
          </span>
          <ng-container class="full-width text-overflow-ellipsis nowrap" *ngSwitchCase="columnTypesEnum.TEMPLATE">
            <ng-container *ngIf="column.template">
              <ng-container *ngTemplateOutlet="column.template; context:{entity: entity}"></ng-container>
            </ng-container>
          </ng-container>
          <span  class="full-width text-overflow-ellipsis nowrap" *ngSwitchDefault>
            {{column.displayedProp ? (entity | parseObjectKey:column.displayedProp) : entity[column.key]}}
          </span>
        </ng-container>
      </mat-cell>
    </ng-container>
    <ng-container matColumnDef="actionButtons">
      <mat-header-cell *matHeaderCellDef fxLayout="row" fxLayoutAlign="end center" class="action-buttons-container">{{ 'COMMON.ACTION_BUTTONS' | transloco}}</mat-header-cell>
      <mat-cell *matCellDef="let entity">
        <div fxLayout="row" fxLayoutGap=".5rem" fxLayoutAlign="end center" class="action-buttons-container">
          <ng-container *ngFor="let action of actionButtons">
            <button [color]="action.color" *ngIf="!action.conditionField || (entity[action.conditionField] === action.conditionValue)" mat-mini-fab (click)="handleActionButtonTrigger(action, entity)" [matTooltip]="action.tooltipKey | transloco">
              <div fxLayout="row" fxLayoutAlign="center center">
                <mat-icon>{{action.icon}}</mat-icon>
              </div>
            </button>
          </ng-container>
        </div>
      </mat-cell>
    </ng-container>
    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns" 
            [ngClass]="{ 'clickable-row': routeRedirect }"
            [routerLink]="routeRedirect ? (routeRedirect | routeParser: row) : null"
        ></mat-row>
  </mat-table>
  <mat-paginator class="full-width" [length]="dataSource.numberOfEntity$ | async" [pageSize]="pageSize"
                 [pageSizeOptions]="pageSizeOptions"></mat-paginator>
</div>
